"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}!function(t){function e(e){console.log("loadPage",e);var n=t(".page-body"),o=t(".searchbox"),r=n.attr("data-page-id");n.load("/"+e,function(i,c,s){if("success"===c){var u=n.find(".page").attr("data-page-id"),l=n.find(".page").attr("data-page-title");u?(r&&a[r]&&(a[r].destroy||t.noop)(n),o.toggle(!!n.find(".page.with-searchbox").length),t("nav .page-title").html(l),n.off("searchbox:search"),n.attr("data-page-id",u),a[u]&&(a[u].ready||t.noop)(n)):(o.hide(),n.empty(),swal({title:"Page id not found",text:"The page script can not be executed",type:"error"}))}else o.hide(),n.empty(),swal({title:"Page not found",text:e,type:"error"})})}function n(t,e,n,a){var o=Rx.Observable.merge(Rx.Observable.fromEvent(t,"keyup"),Rx.Observable.fromEvent(t,"blur")).map(function(t){return t.target.value.trim().toUpperCase()}).filter(function(t){return 0===t.length||t.length>=e}).debounce(n).distinctUntilChanged(),r=Rx.Observable.fromEvent(t,"rx-search-force").map(function(t){return t.target.value.trim()}).debounce(n),i=Rx.Observable.fromEvent(t,"rx-search-force-now").map(function(t){return t.target.value.trim()});Rx.Observable.merge(o,r,i).subscribe(a)}var a={};window.JSVIEW={define:function(t,e){a[t]=e}},t(function(){var a="sync",o=function(t){var n=/^#!(.*)/.exec(t);n&&e(n[1]||a)};window.onhashchange=function(){o(location.hash)},n(t(".searchbox input"),3,500,function(e){t(".page-body").trigger("searchbox:search",e)}),o(location.hash||"#!"+a)})}(jQuery),function(t){JSVIEW.define("remote",{ready:function(e){t("[data-action]",e).click(function(e){e.stopPropagation(),e.preventDefault();var n=e.target.attributes["data-action"].value,a=e.target.attributes["data-confirm-title"].value,o=e.target.attributes["data-confirm-message"].value;swal({title:a,text:o,showCancelButton:!0},function(e){e&&t.get("/remote/"+n).then(function(){setTimeout(function(){document.location.reload(!0)},500)}).fail(function(t,e,n){swal({title:"Load processes",text:e+": "+n,type:"error"})})})})}})}(jQuery),function(t){var e=void 0;JSVIEW.define("sync",{ready:function(n){var a=t("#qrcode",n),o=a.attr("data-sid");a.qrcode({width:256,height:256,text:o}),t("#btnNewCode",n).click(function(t){document.location.reload()}),e=new WebSocket("ws://"+location.host+"/sync/wsh/"+o),e.onopen=function(t){e.send(JSON.stringify({message:"wait for sync"}))},e.onerror=function(t){console.log(t)},e.onmessage=function(r){var i=JSON.parse(r.data);"sync timeout"===i.message?(a.hide(),t("#btnNewCode",n).show(),e.close()):"sync start"===i.message&&(location.href="#!sync/comics/"+o)}},destroy:function(t){e.close()}})}(jQuery),function(t){function e(t,e){e.stopPropagation(),e.preventDefault();var n=e.currentTarget.attributes["data-action"].value,o=(e.currentTarget.attributes["data-action-params"].value||"").split(",");a[n]?a[n].apply(a,[t].concat(_toConsumableArray(o))):console.error("action "+n+" not found")}var n=void 0;JSVIEW.define("synccomics",{ready:function(a){var o=t(".comics-list"),r=o.attr("data-sid");a.on("searchbox:search",function(e,n){n?!function(){var e=n.split(/\s/),a=(e.length,new RegExp("("+n.replace(/\s/g,"|")+")","gi"));t(">.comics",o).hide().filter(function(t,n){var o=n.attributes["data-search"].value.match(a);return o&&0===_.difference(e,o).length}).show()}():t(".comics-list>.comics").show()}),t("[data-action]",o).click(function(t){return e(r,t)}),n=new WebSocket("ws://"+location.host+"/sync/wsh/"+r),n.onopen=function(t){},n.onerror=function(t){console.error(t)},n.onmessage=function(t){var e=JSON.parse(t.data);toastr.success(e.message)}},destroy:function(t){n.close()}});var a={edit:function(e,n){toastr.info(n),t("#modal1").openModal(),t(".synccomics").addClass("editmode"),t(".comics-detail select").material_select()}}}(jQuery),function(t){var e={datetime:function(t){return moment(+t).format("YYYY-MM-DD HH:mm:ss")},status:function(t){return e[t]||t},0:"NO_SYNC",1:"SYNCED",3:"DATA_RECEIVED"};JSVIEW.define("synclist",{ready:function(n){t("[data-format]",n).each(function(t,n){n.innerHTML=e[n.attributes["data-format"].value](n.innerText)}),t("a[data-action]",n).click(function(e){e.stopPropagation(),e.preventDefault();var n=e.target.attributes["data-action"].value,a=e.target.attributes["data-sid"].value;swal({title:n.capitalize()+" "+a+"?",showCancelButton:!0,closeOnConfirm:!0},function(e){e&&setTimeout(function(){"sync"===n||("expire"===n?t.post("/sync/change/"+a,{lastSync:Date.now()-3e4}).then(function(){location.reload()}).fail(function(t,e,n){swal({title:"Expire",text:e+": "+n,type:"error"})}):"remove"===n&&t.post("/sync/remove/"+a).then(function(){location.reload()}).fail(function(t,e,n){swal({title:"Remove",text:e+": "+n,type:"error"})}))},100)})})}})}(jQuery),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$.fn.ensureVisible=function(){$(this).each(function(){$(this)[0].scrollIntoView()})};
//# sourceMappingURL=all.min.js.map

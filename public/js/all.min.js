"use strict";!function(t){function e(e){var n=t(".page-body"),a=t(".searchbox"),r=n.attr("data-page-id");n.load("/"+e,function(i,c,s){if("success"===c){var u=n.find(".page").attr("data-page-id");u?(r&&o[r]&&(o[r].destroy||t.noop)(n),a.toggle(!!n.find(".page.with-searchbox").length),n.off("searchbox:search"),n.attr("data-page-id",u),o[u]&&(o[u].ready||t.noop)(n)):(a.hide(),n.empty(),swal({title:"Page id not found",text:"The page script can not be executed",type:"error"}))}else a.hide(),n.empty(),swal({title:"Page not found",text:e,type:"error"})})}function n(t,e,n,o){var a=Rx.Observable.merge(Rx.Observable.fromEvent(t,"keyup"),Rx.Observable.fromEvent(t,"blur")).map(function(t){return t.target.value.trim().toUpperCase()}).filter(function(t){return 0===t.length||t.length>=e}).debounce(n).distinctUntilChanged(),r=Rx.Observable.fromEvent(t,"rx-search-force").map(function(t){return t.target.value.trim()}).debounce(n),i=Rx.Observable.fromEvent(t,"rx-search-force-now").map(function(t){return t.target.value.trim()});Rx.Observable.merge(a,r,i).subscribe(o)}var o={};window.JSVIEW={define:function(t,e){o[t]=e}},t(function(){var o="sync";window.onhashchange=function(){e(location.hash.substr(1)||o)},n(t(".searchbox>input"),3,500,function(e){t(".page-body").trigger("searchbox:search",e)}),e(location.hash.substr(1)||o)})}(jQuery),function(t){JSVIEW.define("remote",{ready:function(e){t("button[data-action]",e).click(function(e){e.stopPropagation(),e.preventDefault();var n=e.target.attributes["data-action"].value,o=e.target.attributes["data-confirm-title"].value,a=e.target.attributes["data-confirm-message"].value;swal({title:o,text:a,showCancelButton:!0},function(e){e&&t.get("/remote/"+n).then(function(){setTimeout(function(){document.location.reload(!0)},500)}).fail(function(t,e,n){swal({title:"Load processes",text:e+": "+n,type:"error"})})})})}})}(jQuery),function(t){var e=void 0;JSVIEW.define("sync",{ready:function(n){var o=t("#qrcode",n),a=o.attr("data-sid");o.qrcode({width:256,height:256,text:a}),t("#btnNewCode",n).click(function(t){document.location.reload()}),e=new WebSocket("ws://"+location.host+"/sync/wsh/"+a),e.onopen=function(t){e.send(JSON.stringify({message:"wait for sync"}))},e.onerror=function(t){console.log(t)},e.onmessage=function(r){var i=JSON.parse(r.data);"sync timeout"===i.message?(o.hide(),t("#btnNewCode",n).show(),e.close()):"sync start"===i.message&&(location.href="#sync/comics/"+a)}},destroy:function(t){e.close()}})}(jQuery),function(t){var e=void 0;JSVIEW.define("synccomics",{ready:function(n){var o=t(".comics-list"),a=o.attr("data-sid");n.on("searchbox:search",function(e,n){n?!function(){var e=n.split(/\s/),a=(e.length,new RegExp("("+n.replace(/\s/g,"|")+")","gi"));t(">.comics",o).hide().filter(function(t,n){var o=n.attributes["data-search"].value.match(a);return o&&0===_.difference(e,o).length}).show()}():t(".comics-list>.comics").show()}),e=new WebSocket("ws://"+location.host+"/sync/wsh/"+a),e.onopen=function(t){},e.onerror=function(t){console.log(t)},e.onmessage=function(t){var e=JSON.parse(t.data);toastr.success(e.message)}},destroy:function(t){e.send(JSON.stringify({message:"stop sync"})),e.close()}})}(jQuery),function(t){var e={datetime:function(t){return moment(+t).format("YYYY-MM-DD HH:mm:ss")},status:function(t){return e[t]||t},0:"NO_SYNC",1:"SYNCED",3:"DATA_RECEIVED"};JSVIEW.define("synclist",{ready:function(n){t("[data-format]",n).each(function(t,n){n.innerHTML=e[n.attributes["data-format"].value](n.innerText)}),t("a[data-action]",n).click(function(e){e.stopPropagation(),e.preventDefault();var n=e.target.attributes["data-action"].value,o=e.target.attributes["data-sid"].value;swal({title:n.capitalize()+" "+o+"?",showCancelButton:!0,closeOnConfirm:!0},function(e){e&&setTimeout(function(){"sync"===n||("expire"===n?t.post("/sync/change/"+o,{lastSync:Date.now()-3e4}).then(function(){location.reload()}).fail(function(t,e,n){swal({title:"Expire",text:e+": "+n,type:"error"})}):"remove"===n&&t.post("/sync/remove/"+o).then(function(){location.reload()}).fail(function(t,e,n){swal({title:"Remove",text:e+": "+n,type:"error"})}))},100)})})}})}(jQuery),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};
//# sourceMappingURL=all.min.js.map
